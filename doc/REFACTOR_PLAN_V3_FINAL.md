# 주요 일정 기능 리팩토링 및 개선 계획 (v3 Final)

## 1. 개요

사용자 피드백을 반영하여, 분리된 일정 관리 기능을 **아기 상세 페이지의 '타임라인' 탭으로 통합**하고, 이 탭 내에서 **완전한 일정 관리(CRUD) 기능**을 제공합니다. 또한 **일정 노출 UI를 최소 공간으로 최대 효과**를 낼 수 있도록 전면 개편합니다.

---

## 2. 주요 변경 사항

### 가. 아기 상세 페이지 레이아웃 전면 개편 ⭐ 핵심 변경

#### 현재 문제점
```
┌─────────────────────────────────────┐
│ [아기 이름]                         │
│ 최근 활동을 기록하고...  ← 불필요   │
├─────────────────────────────────────┤
│                                     │
│   📏 성장 기록 카드 (큼)            │
│                                     │
├─────────────────────────────────────┤
│                                     │
│   📅 다가오는 주요 일정 (너무 큼!)  │
│   - 일정 1                          │
│   - 일정 2                          │
│   [전체 일정 보기]                  │
│                                     │
└─────────────────────────────────────┘
```
**문제:**
- 일정 카드가 너무 많은 공간 차지 (200px 이상)
- 사용자가 스크롤해야 주요 콘텐츠(활동 기록) 확인 가능
- 시각적으로 산만함

#### 개선된 레이아웃 (최종안)

```
┌─────────────────────────────────────────────────┐
│ [아기 이름]  ← description 제거                 │
├─────────────────────────────────────────────────┤
│ 🔔 임박한 일정 (2)         [전체보기 →]         │ ← 60px 높이
│ ┌──────────────┐ ┌──────────────┐              │
│ │ D-3  🩹      │ │ D-7  💉      │  ← 스와이프   │
│ │ BCG 예방접종 │ │ 4개월 검진   │     가능      │
│ └──────────────┘ └──────────────┘  ●○○         │
├─────────────────────────────────────────────────┤
│ 📏 성장 기록  [입력] [차트]                     │ ← 40px 높이
├─────────────────────────────────────────────────┤
│                                                 │
│ 최근 활동 타임라인 (메인 콘텐츠)               │
│                                                 │
└─────────────────────────────────────────────────┘
```

**핵심 개선점:**
- ✅ 일정 영역: 200px → **60px로 축소** (70% 감소)
- ✅ 성장 기록: 인라인 버튼으로 축소
- ✅ PageHeader description 제거로 20px 절약
- ✅ **총 160px 이상의 공간 확보** → 메인 콘텐츠가 바로 보임

---

### 나. 일정 노출 UI: 5가지 옵션 심층 분석 ⭐

사용자 요구사항:
- ✅ 작은 공간 차지 (최소화)
- ✅ 효과적으로 일정 노출
- ✅ 자동 회전 여부 고민
- ✅ 시각적으로 깔끔

#### 옵션 1: 미니 배너 자동 회전 (Auto-Rotating Mini Banner)

```
┌──────────────────────────────────────────────┐
│ 🔔 D-3: BCG 예방접종 (12/03)   [전체보기] ●○○ │ ← 40px
└──────────────────────────────────────────────┘
```

**특징:**
- 한 번에 1개 일정만 표시
- 3-5초마다 자동 전환 (fade 애니메이션)
- 인디케이터 점(●○○)으로 총 개수 표시
- 호버/터치 시 일시정지

**장점:**
- ✅ 매우 작은 공간 (40-50px)
- ✅ 심플하고 깔끔
- ✅ 모바일에서 완벽

**단점:**
- ❌ 여러 일정을 한눈에 못 봄
- ❌ 자동 회전이 산만할 수 있음
- ❌ 사용자가 원하는 일정 보려면 대기 필요

**점수: 7/10** (공간 효율 최고, 정보 전달력 부족)

---

#### 옵션 2: 가로 스크롤 칩 바 (Horizontal Scrollable Chips)

```
┌───────────────────────────────────────────────────┐
│ 🔔 임박한 일정                    [전체보기 →]    │
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐               │ ← 50px
│ │D-3  │ │D-7  │ │D-14 │ │D-21 │  ← 가로 스크롤  │
│ │BCG  │ │검진 │ │...  │ │...  │                │
│ └─────┘ └─────┘ └─────┘ └─────┘               │
└───────────────────────────────────────────────────┘
```

**특징:**
- 작은 칩(Chip) 형태로 여러 일정 표시
- 가로 스크롤 가능 (스냅 스크롤)
- 각 칩 클릭 시 타임라인으로 이동
- 자동 회전 없음 (사용자 제어)

**장점:**
- ✅ 여러 일정을 동시에 볼 수 있음
- ✅ 사용자가 직접 컨트롤 (덜 산만함)
- ✅ 모던하고 직관적

**단점:**
- ❌ 모바일에서 스크롤 인지 어려울 수 있음
- ❌ 자동 노출 효과 없음
- ❌ 칩이 너무 작으면 가독성 저하

**점수: 8/10** (균형 잡힌 옵션)

---

#### 옵션 3: 마퀴/티커 스타일 (Marquee/Ticker)

```
┌────────────────────────────────────────────────────┐
│ ← D-3: BCG 예방접종 | D-7: 건강검진 | D-14: 소아과 ... │ ← 35px
└────────────────────────────────────────────────────┘
```

**특징:**
- 텍스트가 왼쪽으로 흐르듯이 이동 (무한 반복)
- 모든 일정을 자동으로 노출
- 호버 시 일시정지
- 클릭 시 타임라인으로 이동

**장점:**
- ✅ 가장 작은 공간 (35-40px)
- ✅ 모든 일정을 자동으로 노출
- ✅ 시선을 확실히 끄는 효과

**단점:**
- ❌ 가독성 낮음 (움직이는 텍스트 읽기 어려움)
- ❌ 너무 산만하고 시끄러운 느낌
- ❌ 특정 일정에 집중하기 어려움
- ❌ 접근성 문제 (스크린 리더, 어지러움)

**점수: 5/10** (공간 효율은 높지만 UX 문제 많음)

---

#### 옵션 4: 콤팩트 카드 슬라이더 (Compact Card Slider) - 단일

```
┌────────────────────────────────────┐
│ 🔔 임박한 일정 (3)  [전체보기 →]   │
│ ┌──────────────────────────────┐   │
│ │ D-3  🩹 BCG 예방접종         │   │ ← 80px
│ │ 2025.12.03 (화)        ● ○ ○ │   │
│ └──────────────────────────────┘   │
└────────────────────────────────────┘
```

**특징:**
- 1개의 콤팩트 카드만 표시
- 3-4초마다 자동 전환 (슬라이드 애니메이션)
- 인디케이터로 전체 개수 표시
- 스와이프로 수동 전환 가능

**장점:**
- ✅ 정보를 명확하게 표시
- ✅ 날짜, 아이콘 등 상세 정보 포함 가능
- ✅ 자동/수동 전환 둘 다 지원

**단점:**
- ❌ 80px로 다소 높음
- ❌ 1개씩만 보여서 답답할 수 있음

**점수: 7.5/10** (정보 전달력 좋지만 공간 조금 아쉬움)

---

#### 옵션 5: 듀얼 카드 캐러셀 (Dual Card Carousel) ⭐ 최종 추천

```
┌──────────────────────────────────────────────────┐
│ 🔔 임박한 일정 (5)                [전체보기 →]   │
│ ┌──────────────┐ ┌──────────────┐               │
│ │ D-3  🩹      │ │ D-7  💉      │               │ ← 60-70px
│ │ BCG 예방접종 │ │ 4개월 검진   │   ● ○ ○       │
│ │ 12/03 (화)   │ │ 12/07 (토)   │               │
│ └──────────────┘ └──────────────┘               │
└──────────────────────────────────────────────────┘
```

**특징:**
- **2개의 작은 카드를 동시에 표시**
- 5초마다 다음 2개로 자동 전환 (슬라이드 애니메이션)
- 인디케이터로 전체 페이지 수 표시 (예: ●○○ = 3페이지)
- 스와이프/드래그로 수동 전환 가능
- 각 카드 클릭 시 타임라인으로 이동
- 호버/터치 시 자동 전환 일시정지
- 임박한 일정(D-14 이내)은 빨간색 테두리 강조

**장점:**
- ✅ 2개를 동시에 봐서 정보 전달력 우수
- ✅ 60-70px로 공간 효율 좋음
- ✅ 자동 회전으로 여러 일정 노출
- ✅ 수동 제어도 가능 (덜 산만함)
- ✅ 날짜, 아이콘 등 상세 정보 포함
- ✅ 모바일에서 터치 제스처 자연스러움
- ✅ 시각적으로 균형 잡힘

**단점:**
- ❌ 구현 복잡도가 약간 높음 (Swiper.js 등 필요)
- ❌ 60-70px로 옵션 1, 3보다는 높음

**점수: 9.5/10** ⭐ **최고 점수**

---

### 다. 최종 선택: 옵션 5 (듀얼 카드 캐러셀) ⭐

#### 선택 이유

1. **공간 효율 vs 정보 전달 최적의 균형**
   - 60-70px로 충분히 작음 (기존 대비 70% 절감)
   - 2개를 동시에 봐서 한눈에 파악 가능

2. **사용자 경험 극대화**
   - 자동 회전으로 여러 일정 노출 (수동 조작 불필요)
   - 스와이프로 사용자가 직접 제어도 가능
   - 호버 시 일시정지로 산만함 방지

3. **시각적 완성도**
   - 2개의 작은 카드가 나란히 배치되어 균형감 있음
   - 임박한 일정 강조 (빨간색 테두리)
   - D-Day 카운터가 명확히 보임

4. **모바일 친화적**
   - 터치 제스처가 자연스러움 (스와이프)
   - 작은 화면에서도 2개 카드가 잘 보임

#### 상세 스펙

**레이아웃:**
```
┌──────────────────────────────────────────────────┐
│ [헤더 영역]                                      │
│   🔔 임박한 일정 (5)              [전체보기 →]   │ ← 20px
├──────────────────────────────────────────────────┤
│ [카드 영역]                                      │
│   ┌──────────────┐ ┌──────────────┐             │
│   │ [D-Day]      │ │ [D-Day]      │             │
│   │ [아이콘]     │ │ [아이콘]     │             │ ← 40px (카드 본체)
│   │ [제목]       │ │ [제목]       │             │
│   │ [날짜]       │ │ [날짜]       │             │
│   └──────────────┘ └──────────────┘             │
│                              ● ○ ○               │ ← 10px (인디케이터)
└──────────────────────────────────────────────────┘
총 높이: 70px
```

**카드 디자인:**
- 너비: 화면의 45% (2개가 나란히 배치)
- 높이: 40px
- 배경: 흰색 (기본), 빨간색 계열 (D-14 이내)
- 테두리: 회색 (기본), 빨간색 (D-14 이내)
- 모서리: 둥글게 (border-radius: 8px)
- 그림자: 미세한 그림자 (hover 시 진해짐)

**카드 내용:**
```
┌──────────────┐
│ D-3  🩹      │ ← D-Day (굵게) + 아이콘
│ BCG 예방접종 │ ← 제목 (최대 2줄, ellipsis)
│ 12/03 (화)   │ ← 날짜 (작은 글씨, 회색)
└──────────────┘
```

**자동 회전 설정:**
- 전환 간격: 5초
- 애니메이션: 슬라이드 (좌→우로 밀리는 느낌)
- 애니메이션 시간: 0.5초
- 호버/터치 시: 자동 전환 일시정지
- 마지막 페이지에서: 첫 페이지로 무한 반복

**인터랙션:**
- 클릭: 타임라인 탭으로 이동
- 스와이프 (좌/우): 수동 페이지 전환
- 호버 (데스크톱): 카드 살짝 올라감 (translateY: -2px)
- 터치 (모바일): 탭 피드백 (scale: 0.98)

**반응형:**
- 데스크톱 (768px 이상): 2개 카드 표시
- 모바일 (768px 미만): 2개 카드 표시 (좁게)
- 매우 작은 화면 (480px 미만): 1개 카드만 표시 (옵션 4로 폴백)

**구현 라이브러리:**
- **추천 1:** Swiper.js (가장 강력, 자동 재생/터치 제스처 완벽 지원)
- **추천 2:** Embla Carousel (가볍고 빠름, React 친화적)
- **추천 3:** 직접 구현 (react-spring + useGesture, 커스터마이징 최대)

---

### 라. PageHeader 개선

**변경 전:**
```tsx
<PageHeader
  title="아기 이름"
  description="최근 활동을 기록하고 타임라인을 확인하세요."
/>
```

**변경 후:**
```tsx
<PageHeader
  title="아기 이름"
  // description 제거
/>
```

**절감 공간:** 약 20-25px

---

### 마. 성장 기록 카드 축소 (선택 사항)

**현재:**
```
┌─────────────────────────────────┐
│ 📏 성장 기록                    │
│                                 │ ← 여백
│ [키&체중 입력] [성장 차트]      │
│                                 │
└─────────────────────────────────┘
높이: 80-100px
```

**개선안:**
```
┌─────────────────────────────────┐
│ 📏 성장 기록  [입력] [차트]     │ ← 인라인 배치
└─────────────────────────────────┘
높이: 40px
```

**절감 공간:** 약 40-60px

---

### 바. '타임라인' 탭: 완전한 일정 관리 시스템

#### 기본 구조
- **As-Is**: 별도의 `/schedules` 페이지 존재
- **To-Be**: `/schedules` 페이지 **삭제**, 아기 상세 페이지에 **'타임라인' 탭 신설**

#### 핵심 기능

**1) 완전한 CRUD 기능**
- **전체 일정 조회**: 시간 순 정렬된 세로 타임라인
- **완료 처리**: 체크박스로 완료/미완료 토글
- **일정 추가**: '새 일정 추가' 버튼
- **일정 수정**: 항목 클릭 시 수정 모달
- **일정 삭제**: 삭제 버튼

**2) 필터링 시스템** ⭐
```
상태별: [전체 | 예정 | 완료]
타입별: [전체 | 예방접종 | 건강검진 | 사용자 일정]
기간별: [전체 | 이번 주 | 이번 달 | 3개월 내]
```
- 필터 조합 가능
- URL 쿼리로 상태 유지
- 결과 개수 표시

**3) 검색 기능**
- 제목/내용 실시간 검색
- 검색어 하이라이팅
- 최소 2자 이상

**4) 성능 최적화** ⭐ 무한 스크롤 확정
- **무한 스크롤 (Infinite Scroll)**:
  - 초기 로드: 오늘 기준 ±3개월 일정만 로드
  - 스크롤 시 추가 데이터 로드 (20개씩)
  - "로딩 중..." 스피너 표시
  - 끝에 도달 시 "모든 일정을 불러왔습니다" 메시지
  - `react-intersection-observer` 또는 `IntersectionObserver` 활용

**5) UX 개선**
- **"Today" 마커**:
  - 타임라인 중앙에 명확히 표시
  - 스크롤 시 오늘 위치로 자동 이동
  - 다른 색상/스타일로 강조

- **D-Day 카운터**:
  - 미래: "D-7", "D-14"
  - 임박 (D-14 이내): 빨간색
  - 오늘: "D-Day" 배지
  - 과거: "D+3"

**6) 모바일 최적화**
- 좌우 여백 최소화
- 터치 제스처 (스와이프로 삭제)
- 필터는 하단 시트(Bottom Sheet)

**7) 기존 컴포넌트 재사용**
- `TodoItem` (체크박스, 삭제)
- `TodoDetailModal` (편집)
- `Timeline` UI 컴포넌트
- 기존 서버 액션

---

### 사. 대시보드 카드 개선

**UpcomingScheduleCard 변경:**
- 삭제하고 새로운 `CompactScheduleCarousel` 컴포넌트로 교체
- 링크: `href="/schedules"` → `href="/babies/[babyId]?tab=timeline"`
- 버튼 텍스트: "전체 일정 보기"

---

### 아. 아기 등록 시 일정 자동 생성

**현재 상태:**
- ✅ 이미 구현됨 (`src/features/babies/actions.ts:29-35`)

**개선 사항:**
- 아기 등록 완료 후 **토스트 메시지**:
  ```
  ✅ 아기가 등록되었습니다!
  📅 예방접종, 건강검진 등 32개의 일정이 자동으로 생성되었습니다.
  [타임라인에서 확인하기]
  ```

**재생성 기능 (숨김):**
- 타임라인 탭의 설정(⚙️) 메뉴에 "일정 재생성" 옵션
- Admin/Owner만 접근 가능
- 확인 다이얼로그로 실수 방지

---

### 자. 발달 마일스톤 제거

**제거 대상:**
- `src/features/schedules/components/MilestoneItem.tsx`
- `src/features/schedules/components/MilestoneListDialog.tsx`
- 마일스톤 관련 서버 액션
- 일정 생성 시 마일스톤 데이터 생성 로직
- 대시보드 카드에서 마일스톤 표시

---

## 3. 구현 단계

### Phase 1: 듀얼 카드 캐러셀 구현 ⭐ 최우선
1. `CompactScheduleCarousel` 컴포넌트 생성
2. Swiper.js 또는 Embla Carousel 설치
3. 2개 카드 레이아웃 구현
4. 자동 회전 로직 (5초 간격)
5. 스와이프/터치 제스처
6. 인디케이터 추가
7. 임박한 일정 강조 (빨간색)
8. 반응형 처리 (모바일 1개 카드로 폴백)

### Phase 2: 레이아웃 재배치
1. `/babies/[id]/page.tsx`에서 PageHeader description 제거
2. 새 `CompactScheduleCarousel`을 최상단에 배치
3. `MeasurementCard`를 인라인 버튼으로 축소
4. 기존 `UpcomingScheduleCard` 제거

### Phase 3: 타임라인 탭 생성
1. `/babies/[id]/page.tsx`에 'timeline' 탭 추가
2. `ScheduleTimeline` 컴포넌트 개선 (CRUD 기능)
3. "새 일정 추가" 버튼
4. "Today" 마커와 D-Day 카운터

### Phase 4: 필터링 & 검색
1. 필터 UI 컴포넌트
2. `useScheduleFilters` 훅
3. 검색 입력 및 하이라이팅
4. URL 쿼리 파라미터 관리

### Phase 5: 무한 스크롤 구현 ⭐
1. 서버 API에 페이지네이션 추가 (`offset`, `limit` 파라미터)
2. `IntersectionObserver` 또는 `react-intersection-observer` 활용
3. 초기 로드: 오늘 ±3개월
4. 스크롤 시 20개씩 추가 로드
5. 로딩 스피너 및 끝 메시지

### Phase 6: 모바일 최적화 & 폴리싱
1. 반응형 디자인
2. 터치 제스처 (스와이프 삭제)
3. 애니메이션 및 전환 효과
4. 접근성 (a11y)

### Phase 7: 정리 및 제거
1. `/schedules` 페이지 삭제
2. 발달 마일스톤 파일 삭제
3. "일정 자동 생성", "일정 초기화" 버튼 제거
4. 아기 등록 후 토스트 메시지 추가
5. URL 리디렉션 설정 (`/schedules` → `/babies/xxx?tab=timeline`)

---

## 4. 예상 공간 절감 효과

| 항목 | 기존 높이 | 개선 후 | 절감량 |
|------|----------|---------|--------|
| PageHeader description | 25px | 0px | **-25px** |
| 다가오는 주요 일정 카드 | 220px | 70px | **-150px** |
| 성장 기록 카드 | 100px | 40px | **-60px** |
| **총합** | **345px** | **110px** | **-235px (68% 절감!)** |

**결과:** 메인 콘텐츠(활동 기록)가 **235px 위로** 올라와 즉시 보임!

---

## 5. 기대 효과

### 사용자 경험
- ✅ 스크롤 없이 주요 콘텐츠 즉시 확인
- ✅ 일정을 작은 공간에서 효과적으로 파악
- ✅ 자동 회전으로 여러 일정 자연스럽게 노출
- ✅ 타임라인 탭에서 완전한 일정 관리
- ✅ 필터/검색으로 원하는 일정 빠르게 찾기
- ✅ 무한 스크롤로 쾌적한 성능

### 개발자 경험
- ✅ 기존 코드 재사용 (TodoItem, Timeline 등)
- ✅ 유지보수 쉬운 컴포넌트 구조
- ✅ 확장 가능한 아키텍처

### 비즈니스
- ✅ 사용자 만족도 향상 (직관적 UX)
- ✅ 이탈률 감소 (메인 콘텐츠 즉시 노출)
- ✅ 일정 기능 활용도 증가

---

## 6. 기술 스택

**듀얼 카드 캐러셀:**
- **Swiper.js** (추천): 자동 재생, 터치 제스처 완벽 지원
- **Embla Carousel**: 가볍고 빠름, React 친화적
- **Framer Motion**: 애니메이션 세밀한 제어

**무한 스크롤:**
- `react-intersection-observer`: React 훅으로 간편
- 또는 네이티브 `IntersectionObserver` API

**상태 관리:**
- URL 쿼리: `next/navigation`의 `useSearchParams`
- 필터 상태: Context API 또는 Zustand (선택)

---

## 7. 마이그레이션

**URL 리디렉션:**
```ts
// middleware.ts 또는 next.config.js
{
  source: '/schedules',
  destination: '/babies/:babyId?tab=timeline',
  permanent: true
}
```

**데이터베이스:**
- 기존 `Note` 테이블 스키마 변경 불필요
- 마일스톤 타입 데이터는 소프트 삭제 또는 타입 필터링

---

## 8. 요약

**핵심 변경점:**
1. ✅ **듀얼 카드 캐러셀**로 일정을 작고 효과적으로 노출 (70px)
2. ✅ **235px 공간 절감** (68% 감소) → 메인 콘텐츠 즉시 노출
3. ✅ PageHeader description 제거
4. ✅ 성장 기록 카드 축소 (인라인 버튼)
5. ✅ 별도 일정 페이지 삭제 → **'타임라인' 탭** 통합
6. ✅ **필터링/검색** 기능으로 사용성 향상
7. ✅ **무한 스크롤**로 성능 최적화 (확정)
8. ✅ D-Day 카운터와 Today 마커
9. ✅ 아기 등록 시 일정 자동 생성 (이미 구현됨)
10. ✅ 모바일 최적화

**위 최종 계획안대로 진행하겠습니다!** 🚀
